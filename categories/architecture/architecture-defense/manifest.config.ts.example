/**
 * J1: SELF-DESCRIPTION
 *
 * Every module declares its own identity, purpose, and dependencies.
 * This manifest serves as the single source of truth for architecture governance.
 *
 * Location: packages/feature-name/manifest.config.ts
 */

import { Manifest } from '@your-org/architecture-types';

export default {
  // Module Identity
  id: '@your-org/user-management',
  name: 'user-management',
  version: '1.0.0',
  type: 'feature', // 'feature' | 'ui-library' | 'data-layer' | 'shared'

  // Purpose Statement (Why this module exists)
  purpose: [
    'User registration and authentication',
    'Profile management and preferences',
    'User role and permission handling'
  ],

  // Public API (What others can import)
  publicAPI: {
    components: [
      'UserForm',
      'UserProfile',
      'UserList'
    ],
    services: [
      'UserService',
      'AuthService'
    ],
    types: [
      'User',
      'UserProfile',
      'UserRole'
    ],
    hooks: [
      'useUser',
      'useAuth'
    ]
  },

  // Internal API (Private - only for this module)
  internalAPI: {
    components: [
      'UserFormInternal',
      'PasswordField'
    ],
    services: [
      'UserValidationService',
      'PasswordHashService'
    ],
    utils: [
      'validationUtils',
      'passwordUtils'
    ]
  },

  // Dependencies (What we depend on)
  dependencies: {
    // Feature modules
    features: [
      '@your-org/auth-core',
      '@your-org/notifications'
    ],

    // UI libraries
    ui: [
      '@your-org/design-system/button',
      '@your-org/design-system/input'
    ],

    // Data layer
    data: [
      '@your-org/api-client',
      '@your-org/database' // Only if this IS a data-layer module
    ],

    // Shared utilities
    shared: [
      '@your-org/utils/date',
      '@your-org/utils/validation'
    ],

    // External dependencies
    external: [
      'react',
      'zod',
      'react-router-dom'
    ]
  },

  // Dependency Rules (Closed Rules - J3)
  rules: {
    // UI components MUST NOT import from data layer directly
    noDirectDataAccess: {
      target: ['components/**/*', 'hooks/**/*'],
      forbidden: ['@your-org/database', '@your-org/api/**/internal'],
      severity: 'error',
      message: 'UI components must use services, not direct data access'
    },

    // Internal files cannot be imported from other features
    noInternalImports: {
      target: ['**/*'],
      forbidden: ['**/internal/**/*', '**/private/**/*'],
      allowSelf: true,
      severity: 'error',
      message: 'Cannot import internal files from other modules'
    },

    // No circular dependencies
    noCircular: {
      enabled: true,
      severity: 'error',
      message: 'Circular dependencies detected'
    }
  },

  // Layer constraints (for layered architecture)
  layers: {
    ui: ['components', 'hooks', 'views'],
    business: ['services', 'store', 'state'],
    data: ['api', 'database', 'repositories'],
    shared: ['utils', 'types', 'constants']
  },

  // Allowed layer transitions (e.g., UI → Business → Data)
  allowedTransitions: [
    { from: 'ui', to: 'business' },
    { from: 'business', to: 'data' },
    { from: 'business', to: 'shared' },
    { from: 'ui', to: 'shared' }
  ],

  // Metadata for governance
  metadata: {
    owner: 'user-management-team',
    slackChannel: '#user-mgmt',
    docsUrl: 'https://docs.internal.com/user-management',
    lastReviewed: '2025-12-31',
    nextReview: '2026-03-31'
  }
} as Manifest;
